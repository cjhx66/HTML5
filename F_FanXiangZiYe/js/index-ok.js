function init(){$("header").click(function(){$(this).fadeOut(500);$(".main").fadeIn(500);$("#audio")[0].pause();$("#bg")[0].play()});var l=null;var t=false;var s=false;var q=0;var k=new m();var x="images/logo.png";var e=k.createImage(x);var v="images/ewm.jpg";var b=k.createImage(v);var d=[k.createImage("images/wk.png"),k.createImage("images/xc.png")];var a=Math.round(Math.random()*(d.length-1));var p=d[a];var w=localStorage.getItem("info");var z=JSON.parse(w);var A=z.user;var j=z.src;var u=z.city;var c=function(){var C=21456;var B=new Date();B.setFullYear(2019,0,18);B.setHours(0,0,0,0);var F=new Date();var E=F.getTime()-B.getTime();var D=Math.floor(E/(60*10*1000));C+=73*D;return C};if(u=="undefined"){u="重庆"}$(".main").click(function(){$(".m_cq").addClass("active");setTimeout(function(){$(".dialogue").show().addClass("dialogue-acitve");g();$("title").html("重庆023全国后援会");var B=$("body");document.title="重庆023全国后援会";var C=$('<iframe src="/favicon.ico"></iframe>').on("load",function(){setTimeout(function(){C.off("load").remove()},0)}).appendTo(B)},200)});var y=[{title:"我爱科本",img:"images/tx-kb.png",mesage:"群头没开腔是不回重庆迈？",mesage1:"平时像个话包子嫩个，今天啷个不开腔啊，话说你现在在哪里哟？",user_name:A,},{title:"我爱科本",img:"images/tx-kb.png",mesage:"你在那边过的怎么样嘛，",mesage1:"有没有随时暴露重庆人的本性",user_name:A,},{title:"重庆小张",img:"images/cq-xz.png",mesage:"诶对老，出来嫩个久，你最想重庆撒子？",user_name:A,},{title:"我爱科本",img:"images/tx-kb.png",mesage:"重庆百晓生，你晓不晓得勒是哪里嘛",user_name:A,},{title:"我爱科本",img:"images/tx-kb.png",mesage:"如果是你，今年会有回重庆安家的打算吗？",user_name:A,}];var o=[{list1:"1年",list2:"2年",list3:"3年",list4:"4年",list5:"5年",list6:"6年",list7:"7年",list8:"8年",list9:"9年",list10:"10年"},{list1:"对火锅和川菜的蜜汁执着",list2:"被川普social支配的恐惧",list3:"自带暴脾气属性",list4:"偶然听见重庆话，就想立刻确认眼神"},{list1:"火锅江湖菜夜啤酒",list2:"凌晨两点压过的九街",list3:"最爱的亲人&内伙子些",list4:"关于重庆的一切，都想！"},{list1:"南滨路",list2:"万科重庆天地",list3:"北滨路",},{list1:"重庆邮电大学",list2:"万科鹅岭峯",list3:"悦来会展中心",},{list1:"会",list2:"暂时不会",}];$(".input-upload").change(function(E){var D=this.files;if(D&&D.length){var C=D[0];if(/\.(gif|jpg|jpeg|png|GIF|JPG|PNG)$/.test(C.name)){var B=window.URL.createObjectURL(C);f(B,C);$("footer").show()}else{alert("请选择正确的图片格式！")}}});function g(){var H=$(".d_meg").children().last();var D=$(".d_meg").children().not("ul").length;var B=null;if(H.is(":hidden")){H.show();var G=[0.2,0.3,0.4,0.5];var E=Math.floor(Math.random()*4);H.css("animation","liaotian 0.4s "+G[E]+"s ease-out forwards");if(D==1||D==5||D==10||D==13||D==16||D==21||D==27||D==28||D==29||D==32||D==33||D==36||D==37||D==38){setTimeout(function(){$("#music")[0].play()},G[E])}if($(".dialog").height()-H.offset().top<H.height()){h($(".dialog").scrollTop()+H.height()+50)}if(D<=8||D==10||D==12||D>17&&D<20||D>22&&D<27||D==28||D==32||D==36){B="<img src='images/"+(D+1)+".png' alt=''>"}if(D==31){if(t){B="<img src='images/cuo_1.png' alt=''>"}else{B="<img src='images/dui_1.png' alt=''>"}}if(D==35){if(s){B="<img src='images/cuo_2.png' alt=''>"}else{B="<img src='images/dui_2.png' alt=''>"}}if(D==9||D==15){var C=0;if(D==9){C=0}else{if(D==15){C=1}}B="<div class='img_kb clearfix'>"+"<img src='images/tx-kb.png' alt=''>"+"<div class='center'>"+"<p class='title'>"+y[C].title+"</p>"+"<p class='mesage'>"+y[C].mesage+"<span class='user_name'>@"+y[C].user_name+"</span>"+y[C].mesage1+"</p></div></div>"}if(D==11){B="<div class='img_me clearfix'>"+"<img src='"+j+"' alt=''>"+"<div class='center'>"+"<p class='title user_name'>"+A+"</p>"+"<p class='mesage daan0'>"+u+"</p></div></div>"}if(D==20||D==27||D==37){var C=2;if(D==20){C=2}if(D==27){C=3}if(D==37){C=4}B="<div class='img_kb clearfix'>"+"<img src='"+y[C].img+"' alt=''>"+"<div class='center'>"+"<p class='title'>"+y[C].title+"</p>"+"<p class='mesage'><span class='user_name'>@"+y[C].user_name+"</span>"+y[C].mesage+"</p></div></div>"}$(".d_meg").append(B);if(D==13||D==16||D==21||D==29||D==33||D==38){var F="";if(D==13){F="time_an"}else{if(D==16){F="sinian"}else{if(D==21){F="xiangfa"}else{if(D==29){F="pic1"}else{if(D==33){F="pic2"}else{if(D==38){F="last"}}}}}}B="<img src='images/anniu.png' alt='' class='anniu "+F+"'>";$(".d_meg").append(B);i(F)}if(H.find(".daan6").length>0){B="<img src='images/add.png' alt='' class='add'>";$(".d_meg").append(B);$("#upload").show()}l=window.setTimeout(function(){g()},900);if(D>13&&D<15||D>16&&D<18||D>21&&D<23||D>29&&D<31||D>33&&D<35||D>38&&D<40||D>40){window.clearTimeout(l)}}}function i(D){var C=null;var B=0;if(D=="time_an"){C="time_ul";B=0}else{if(D=="sinian"){C="sinian_ul";B=1}else{if(D=="xiangfa"){C="xiangfa_ul";B=2}else{if(D=="pic1"){C="pic1_ul";B=3}else{if(D=="pic2"){C="pic2_ul";B=4}else{if(D=="last"){C="last_ul";B=5}}}}}}$("."+D+"").click(function(){if($("."+C+"").length>0){$("."+C+"").slideDown(200);if(C=="time_ul"){$("."+C+"").css("overflow-y","scroll")}}else{if($("."+C+"").length==0){var F='<ul class="'+C+'">';if(C=="pic1_ul"||C=="pic2_ul"){F='<ul class="pic_ul '+C+'">'}for(var E in o[B]){F+="<li>"+o[B][E]+"</li>";console.log()}F+="</ul>";$(".d_meg").append(F);$("."+C+"").slideDown(200);if(C=="time_ul"){$("."+C+"").css("overflow-y","scroll")
}}}r()})}function r(){var B=null;$(".d_meg ul").off("click","li").on("click","li",function(D){$(this).siblings().removeClass("active");$(this).addClass("active");B=$(this).html();if($(this).parent("ul").hasClass("pic1_ul")){if(B!=o[3].list2){t=true}}if($(this).parent("ul").hasClass("pic2_ul")){if(B!=o[4].list2){s=true}}var C="<div class='img_me clearfix'>"+"<img src="+j+" alt=''>"+"<div class='center'>"+"<p class='title user_name'>"+A+"</p>"+"<p class='mesage daan"+(q+=1)+"'>"+B+"</p></div></div>";$(".d_meg").append(C);$(".d_meg ul").slideUp(200);g()})}function h(B){$(".dialog").animate({scrollTop:B},400)}function f(B,F){var I=$(".daan1").html();switch(I){case"1年":I="一年";break;case"2年":I="两年";break;case"3年":I="三年";break;case"4年":I="四年";break;case"5年":I="五年";break;case"6年":I="六年";break;case"7年":I="七年";break;case"8年":I="八年";break;case"9年":I="九年";break;case"10年":I="十年";break}var C=0;EXIF.getData(F,function(){C=EXIF.getTag(this,"Orientation")});var E=document.getElementById("canvas");var K=E.getContext("2d");E.width=750;E.height=$(window).height();var H=E.height*0.4;var J=H+H*0.35;if(screen.height>=812){J=H+H*0.28}var D=E.height*0.89;var G=E.height*0.83;var L=new Image;L.src=B;L.onload=function(){K.fillRect(0,0,E.width,E.height);if(C==6){K.save();K.translate(E.width/2,E.height/2);K.rotate(90*Math.PI/180);K.drawImage(L,0-E.height/2,0-E.width/2,E.height,E.width);K.restore()}else{K.drawImage(L,0,0,E.width,E.height)}K.save();var M=new Image;M.src="images/mark.png";M.setAttribute("crossOrigin","Anonymous");M.onload=function(){K.drawImage(M,0,H,M.width,M.height);K.save();K.beginPath();K.font="normal 36px PingFang Medium";E.style.letterSpacing="2px";var Q="我是 "+A;var O="我在 "+u;K.letterSpacingText(Q,43,J);K.letterSpacingText(O,43,J+70);K.font="normal 24px PingFang Medium";var N=c();var P="已有"+N+"位重庆游子想家了";K.fillText(P,43,E.height*0.37+540);K.font="normal 68px GSKA00H";E.style.letterSpacing="-5px";K.fillStyle="#b10303";var S="我离开重庆"+I+"了";var R="重庆,我想你了";K.letterSpacingText(S,30,J+160);K.letterSpacingText(R,30,J+238);K.save();K.fillStyle="rgba(0,0,0,0.7)";K.fillRect(0,D-20,E.width,97);K.save();K.drawImage(e,22,D,e.width,e.height);K.save();if(a==1){D=D-10}K.drawImage(p,220,D,p.width,p.height);K.save();K.drawImage(b,550,G,b.width,b.height);K.save();$(".canvasImg").attr("src",E.toDataURL("image/jpeg"));$(".canvasImg").show();$("title").html("第一次被识破重庆人真身的日子");var T=$("body");document.title="第一次被识破重庆人真身的日子";var U=$('<iframe src="/favicon.ico"></iframe>').on("load",function(){setTimeout(function(){U.off("load").remove()},0)}).appendTo(T)}};$(".save").show()}CanvasRenderingContext2D.prototype.letterSpacingText=function(J,H,G,I){var C=this;var D=C.canvas;if(!I&&D){I=parseFloat(window.getComputedStyle(D).letterSpacing)}if(!I){return this.fillText(J,H,G)}var K=J.split("");var F=C.textAlign||"left";var E=C.measureText(J).width;var B=E+I*(K.length-1);if(F=="center"){H=H-B/2}else{if(F=="right"){H=H-B}}C.textAlign="left";K.forEach(function(L){var M=C.measureText(L).width;C.fillText(L,H,G);H=H+M+I});C.textAlign=F};function n(){return/iphone/gi.test(navigator.userAgent)&&(screen.height==812&&screen.width==375)}function m(){var B=[];return{createImage:function(C){return typeof B[C]!="undefined"?B[C]:(B[C]=new Image(),B[C].src=C,B[C])},loadImage:function(C,G){for(var F=0,D=C.length;F<D;F++){var E=C[F];B[E]=new Image();B[E].onload=function(){if(F==D-1&&typeof G=="function"){G()}};B[E].src=E}}}}};